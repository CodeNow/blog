<!doctype html>
<html>

  <title>Runnablog</title>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/blog/favicon.png">
  <link rel="stylesheet" href="//runnable.com/styles/index.css">
  <link rel="stylesheet" href="/blog/css/index.css">
  <link rel="alternate" type="application/rss+xml" title="Runnable Blog" href="https://runnable.com/blog/feed.xml">
  <meta property="og:image" content="//s3-us-west-1.amazonaws.com/runnable-design/fb-image.png">
  <meta name="description" content="The official blog from the team at Runnable.">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@getrunnable">
  
    <meta name="twitter:title" content="Weave + Docker for Mac: The bridge between local and remote services">
    <meta name="twitter:description" content="Integration testing and debugging many microservices can be painful. Often, I need to debug a service on a staging environment. This article shows how we use Docker for Mac with Weave (an overlay network) to connect our local machine to our remote staging environments.In my workflow, I usually create a WIP git commit, push it to staging, and try to debug with the Ubuntu server’s limited tools. I could set up a bunch of SSH tunnels to connect to all the remote services, but our stack changes too frequently and finding IP addresses for each service is a pain. My dev machine is a Mac, so most of the tools we use locally don’t work on Linux.I wanted something better that would speed up my dev and debugging flow. The first thing I tested with the Docker for Mac beta was Weave integration. Weave creates an overlay network to connect containers across multiple hosts together, which is very useful when distributing containers across a Swarm cluster.">
    
  <meta name="twitter:image" content="https://s3-us-west-1.amazonaws.com/runnable-design/tw-image.png">
  
</head>


  <body class="page-landing">

    <svg xmlns="http://www.w3.org/2000/svg" class="icon-defintions">
  <symbol id="icons-bitbucket" viewBox="0 0 27.438 31.681">
    <path d='M29.208,3.519a3.47,3.47,0,0,0-.729-0.738,8.244,8.244,0,0,0-2.01-1.1A21.7,21.7,0,0,0,21.768.45,39.134,39.134,0,0,0,10.037.434,24.268,24.268,0,0,0,6,1.385,10.419,10.419,0,0,0,3.525,2.549a4.165,4.165,0,0,0-.976.869,1.832,1.832,0,0,0-.4,1.479C2.32,5.989,2.48,7.082,2.66,8.169q0.4,2.417.811,4.828c0.306,1.787.62,3.573,0.918,5.36a2.026,2.026,0,0,0,.526,1.07,5.663,5.663,0,0,0,.574.543,9.178,9.178,0,0,0,2.432,1.354,20.379,20.379,0,0,0,6.485,1.328,25.257,25.257,0,0,0,4.838-.187,19.46,19.46,0,0,0,4.011-.948,10.809,10.809,0,0,0,2.725-1.382,4.323,4.323,0,0,0,.945-0.9,1.791,1.791,0,0,0,.354-0.805c0.4-2.341.809-4.679,1.2-7.021,0.362-2.172.7-4.346,1.058-6.518A1.78,1.78,0,0,0,29.208,3.519ZM15.82,19.64a4.361,4.361,0,1,1,4.386-4.334A4.359,4.359,0,0,1,15.82,19.64Zm8.7-15.246a1.832,1.832,0,0,1-.436.357,5.524,5.524,0,0,1-1.454.541,20.191,20.191,0,0,1-2.9.485,37.5,37.5,0,0,1-3.791.188,37.891,37.891,0,0,1-4.332-.238,15.852,15.852,0,0,1-3.146-.633,6.893,6.893,0,0,1-.883-0.381,1.385,1.385,0,0,1-.386-0.3A0.443,0.443,0,0,1,7.2,3.746,1.752,1.752,0,0,1,7.61,3.43a5.392,5.392,0,0,1,1.359-.512,20.355,20.355,0,0,1,2.994-.509,37.618,37.618,0,0,1,4.967-.172,30.478,30.478,0,0,1,4.55.431,10.33,10.33,0,0,1,2.075.545,5.336,5.336,0,0,1,.683.346,1.085,1.085,0,0,1,.288.266A0.422,0.422,0,0,1,24.522,4.394Zm1.664,18.367a0.955,0.955,0,0,1-.021.271c-0.305,1.6-.614,3.2-0.911,4.811a2.6,2.6,0,0,1-.724,1.377,5.442,5.442,0,0,1-1.448,1.023A12.151,12.151,0,0,1,20,31.274a18.806,18.806,0,0,1-3.563.407,20.746,20.746,0,0,1-5.917-.7,9.9,9.9,0,0,1-2.3-.953,5.078,5.078,0,0,1-1.042-.789,2.6,2.6,0,0,1-.741-1.4c-0.3-1.6-.609-3.207-0.915-4.81A1.12,1.12,0,0,1,5.5,22.79a0.479,0.479,0,0,1,.724-0.423c0.036,0.021.072,0.041,0.105,0.063a13.221,13.221,0,0,0,3.858,1.856,18.062,18.062,0,0,0,3.873.758,19.587,19.587,0,0,0,4.54-.11,16.41,16.41,0,0,0,5.687-1.827c0.354-.194.686-0.43,1.025-0.646a1.715,1.715,0,0,1,.167-0.1A0.48,0.48,0,0,1,26.186,22.761Zm-8.159-7.477a2.185,2.185,0,1,1-2.177-2.193A2.192,2.192,0,0,1,18.027,15.284Z', transform='translate(-2.122)'</<path d="M29.208,3.519a3.47,3.47,0,0,0-.729-0.738,8.244,8.244,0,0,0-2.01-1.1A21.7,21.7,0,0,0,21.768.45,39.134,39.134,0,0,0,10.037.434,24.268,24.268,0,0,0,6,1.385,10.419,10.419,0,0,0,3.525,2.549a4.165,4.165,0,0,0-.976.869,1.832,1.832,0,0,0-.4,1.479C2.32,5.989,2.48,7.082,2.66,8.169q0.4,2.417.811,4.828c0.306,1.787.62,3.573,0.918,5.36a2.026,2.026,0,0,0,.526,1.07,5.663,5.663,0,0,0,.574.543,9.178,9.178,0,0,0,2.432,1.354,20.379,20.379,0,0,0,6.485,1.328,25.257,25.257,0,0,0,4.838-.187,19.46,19.46,0,0,0,4.011-.948,10.809,10.809,0,0,0,2.725-1.382,4.323,4.323,0,0,0,.945-0.9,1.791,1.791,0,0,0,.354-0.805c0.4-2.341.809-4.679,1.2-7.021,0.362-2.172.7-4.346,1.058-6.518A1.78,1.78,0,0,0,29.208,3.519ZM15.82,19.64a4.361,4.361,0,1,1,4.386-4.334A4.359,4.359,0,0,1,15.82,19.64Zm8.7-15.246a1.832,1.832,0,0,1-.436.357,5.524,5.524,0,0,1-1.454.541,20.191,20.191,0,0,1-2.9.485,37.5,37.5,0,0,1-3.791.188,37.891,37.891,0,0,1-4.332-.238,15.852,15.852,0,0,1-3.146-.633,6.893,6.893,0,0,1-.883-0.381,1.385,1.385,0,0,1-.386-0.3A0.443,0.443,0,0,1,7.2,3.746,1.752,1.752,0,0,1,7.61,3.43a5.392,5.392,0,0,1,1.359-.512,20.355,20.355,0,0,1,2.994-.509,37.618,37.618,0,0,1,4.967-.172,30.478,30.478,0,0,1,4.55.431,10.33,10.33,0,0,1,2.075.545,5.336,5.336,0,0,1,.683.346,1.085,1.085,0,0,1,.288.266A0.422,0.422,0,0,1,24.522,4.394Zm1.664,18.367a0.955,0.955,0,0,1-.021.271c-0.305,1.6-.614,3.2-0.911,4.811a2.6,2.6,0,0,1-.724,1.377,5.442,5.442,0,0,1-1.448,1.023A12.151,12.151,0,0,1,20,31.274a18.806,18.806,0,0,1-3.563.407,20.746,20.746,0,0,1-5.917-.7,9.9,9.9,0,0,1-2.3-.953,5.078,5.078,0,0,1-1.042-.789,2.6,2.6,0,0,1-.741-1.4c-0.3-1.6-.609-3.207-0.915-4.81A1.12,1.12,0,0,1,5.5,22.79a0.479,0.479,0,0,1,.724-0.423c0.036,0.021.072,0.041,0.105,0.063a13.221,13.221,0,0,0,3.858,1.856,18.062,18.062,0,0,0,3.873.758,19.587,19.587,0,0,0,4.54-.11,16.41,16.41,0,0,0,5.687-1.827c0.354-.194.686-0.43,1.025-0.646a1.715,1.715,0,0,1,.167-0.1A0.48,0.48,0,0,1,26.186,22.761Zm-8.159-7.477a2.185,2.185,0,1,1-2.177-2.193A2.192,2.192,0,0,1,18.027,15.284Z" transform="translate(-2.122)"/>
  </symbol>
  <symbol id="icons-check" viewBox='0 0 14.5 10'>
    <path d="M7.25,14a1,1,0,0,1-.707-0.293l-4.5-4.5A1,1,0,0,1,3.457,7.793L7.25,11.586l7.293-7.293a1,1,0,0,1,1.414,1.414l-8,8A1,1,0,0,1,7.25,14Z" transform="translate(-1.75 -4)"/>
  </symbol>
  <symbol id="icons-chevron-right" viewBox='0 0 11 18'>
    <polyline points="1 1 10 9 1 17" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
  </symbol>
  <symbol id="icons-chevron-down" viewBox='0 0 18 11'>
    <polyline points="17 1 9 10 1 1" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline>
  </symbol>
  <symbol id="icons-close" viewBox="0 0 30 30">
    <path d="M21,22.2c-0.3,0-0.5-0.1-0.7-0.3L15,16.6l-5.3,5.3c-0.4,0.4-1,0.4-1.4,0s-0.4-1,0-1.4l5.3-5.3L8.3,9.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-5.3,5.3l5.3,5.3c0.4,0.4,0.4,1,0,1.4C21.5,22.1,21.3,22.2,21,22.2z"/>
  </symbol>
  <symbol id="icons-external" viewBox="0 0 15 15">
    <path fill="currentColor" d="M9.5,9a0.5,0.5,0,0,1-.354-0.854L14.293,3H11a0.5,0.5,0,0,1,0-1h4.506a0.5,0.5,0,0,1,.32.121h0a0.56,0.56,0,0,1,.07.074,0.5,0.5,0,0,1,.1.269c0,0.013,0,.026,0,0.039V7a0.5,0.5,0,0,1-1,0V3.707L9.854,8.854A0.5,0.5,0,0,1,9.5,9Z" transform="translate(-1 -2)"/><path d="M13.317,8.218L13,8.535V14a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V7A2,2,0,0,1,4,5H9.465l0.317-.317A2.5,2.5,0,0,1,9.027,4H4A3,3,0,0,0,1,7v7a3,3,0,0,0,3,3h7a3,3,0,0,0,3-3V8.973A2.5,2.5,0,0,1,13.317,8.218Z" transform="translate(-1 -2)"/>
  </symbol>
  <symbol id="icons-github" viewBox="0 0 24 23.41">
    <path d="M24.336,7.791A12.011,12.011,0,0,1,25.52,23.366a12.083,12.083,0,0,1-5.883,4.313A0.686,0.686,0,0,1,19,27.549a0.648,0.648,0,0,1-.187-0.457l0.023-3.281a3.861,3.861,0,0,0-.258-1.395,2.219,2.219,0,0,0-.562-0.832,7.008,7.008,0,0,0,3.738-1.348Q23.41,19.03,23.5,15.655a5.127,5.127,0,0,0-.34-1.782,4.569,4.569,0,0,0-.9-1.43,3.254,3.254,0,0,0,.234-1.078,4.936,4.936,0,0,0-.352-2.109,1.719,1.719,0,0,0-.8.035A7.4,7.4,0,0,0,18.84,10.5a11.493,11.493,0,0,0-6,0,7.4,7.4,0,0,0-2.508-1.207,1.719,1.719,0,0,0-.8-0.035,4.936,4.936,0,0,0-.352,2.109,3.254,3.254,0,0,0,.234,1.078,4.569,4.569,0,0,0-.9,1.43,5.127,5.127,0,0,0-.34,1.782Q8.27,19.03,9.91,20.237a6.976,6.976,0,0,0,3.75,1.348,1.934,1.934,0,0,0-.48.633,3.414,3.414,0,0,0-.293.984,3.316,3.316,0,0,1-1.594.293,2.42,2.42,0,0,1-1.9-1.3,3.234,3.234,0,0,0-.645-0.75,1.767,1.767,0,0,0-1.184-.469q-0.7.023-.527,0.3a1.324,1.324,0,0,0,.551.469,2.583,2.583,0,0,1,.75.82,5.653,5.653,0,0,1,.469.867,2.2,2.2,0,0,0,.984,1.172,4.5,4.5,0,0,0,3.047.258l0.023,2.227a0.648,0.648,0,0,1-.187.457,0.686,0.686,0,0,1-.633.129A12.083,12.083,0,0,1,6.16,23.366,12,12,0,0,1,24.336,7.791Z" transform="translate(-3.84 -4.287)"/>
  </symbol>
  <symbol id="icons-life-preserver" viewBox='0 0 18 18'>
    <path d="M9,17A8,8,0,1,0,1,9,8,8,0,0,0,9,17ZM9,5A4,4,0,1,1,5,9,4,4,0,0,1,9,5Z" transform="translate(-1 -1)" fill="#fff"/><path d="M9,2A7,7,0,1,1,2,9,7.008,7.008,0,0,1,9,2M9,13.5A4.5,4.5,0,1,0,4.5,9,4.505,4.505,0,0,0,9,13.5M9,1a8,8,0,1,0,8,8A8,8,0,0,0,9,1H9ZM9,12.5A3.5,3.5,0,1,1,12.5,9,3.5,3.5,0,0,1,9,12.5H9Z" transform="translate(-1 -1)"/><path d="M5.259,7.623A3.989,3.989,0,0,1,7.623,5.259L4.654,2.289A8.032,8.032,0,0,0,2.29,4.653Z" transform="translate(-1 -1)"/><path d="M12.741,10.377a3.989,3.989,0,0,1-2.364,2.364l2.969,2.969a8.032,8.032,0,0,0,2.364-2.364Z" transform="translate(-1 -1)"/><path d="M7.623,12.741a3.989,3.989,0,0,1-2.364-2.364L2.289,13.346A8.032,8.032,0,0,0,4.653,15.71Z" transform="translate(-1 -1)"/><path d="M10.377,5.259a3.989,3.989,0,0,1,2.364,2.364l2.969-2.969A8.032,8.032,0,0,0,13.347,2.29Z" transform="translate(-1 -1)"/>
  </symbol>
  <symbol id="icons-overflow" viewBox="0 0 18 4.688">
    <path fill="currentColor" d="M2.344,7.656A1.344,1.344,0,1,1,1,9,1.345,1.345,0,0,1,2.344,7.656m0-1A2.344,2.344,0,1,0,4.688,9,2.344,2.344,0,0,0,2.344,6.656h0Z" transform="translate(0 -6.656)"/><path fill="currentColor" d="M9,7.656A1.344,1.344,0,1,1,7.656,9,1.345,1.345,0,0,1,9,7.656m0-1A2.344,2.344,0,1,0,11.344,9,2.344,2.344,0,0,0,9,6.656H9Z" transform="translate(0 -6.656)"/><path fill="currentColor" d="M15.656,7.656A1.344,1.344,0,1,1,14.313,9a1.345,1.345,0,0,1,1.344-1.344m0-1A2.344,2.344,0,1,0,18,9a2.344,2.344,0,0,0-2.344-2.344h0Z" transform="translate(0 -6.656)"/>
  </symbol>
</svg>

    <header class="grid-block shrink header">
  <div class="grid-block grid-container justify-justified">
    <a href="/" class="grid-content shrink logo">
      <img class="img" src="https://runnable.com/images/runnable-logo.svg" height="36" width="192">
    </a>
    <nav class="nav grid-block shrink">
      <a href="/docs/" class="grid-content btn btn-sm text-white weight-strong hidden-xs a">Docs</a>
      <a href="/product/" class="grid-content btn btn-sm text-white weight-strong hidden-sm a">Product</a>
      <a href="/pricing/" class="grid-content btn btn-sm text-white weight-strong hidden-md">Pricing</a>
      <a href="/signin" class="grid-content btn btn-sm text-white weight-strong hidden-md js-hide-if-signed-in">Sign In</a>
      <a href="/signup" class="grid-content btn btn-sm btn-white text-white weight-strong hidden-xs js-hide-if-signed-in track-sign-up">Sign Up</a>
      <div class="grid-content btn btn-sm btn-overflow popover-trigger hover has-links" tabindex="1">
        <svg class="icons icons-overflow">
          <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icons-overflow"></use>
        </svg>
        <div class="popover-hover-wrapper right-align-sm">
  <div class="grid-block popover popover-header-menu bottom">
    <div class="grid-block col list text-left">
      <a data-target="#sign-up" class="list-item-a visible-xs js-hide-if-signed-in track-sign-up">Sign Up</a>
      <a data-target="#sign-in" class="list-item-a visible-md js-hide-if-signed-in">Sign In</a>
      <div class="list-item divider visible-md"></div>
      <a href="/docs/" class="list-item-a visible-xs">Docs</a>
      <a href="/for/" class="list-item-a visible-sm">Product</a>
      <a href="/pricing/" class="list-item-a visible-md"><span class="text-request">Pricing</a>
      <a href="/how-it-works/" class="list-item-a">How It Works</a>
      <a href="/demo/" class="list-item-a">Request Demo</a>
      <a href="/blog/" class="list-item-a">Blog</a>
      <a href="/about/" class="list-item-a">About</a>
    </div>
  </div>
</div>

      </div>
    </nav>
  </div>
</header>


    <main class="grid-block col main">
      <div class="grid-block col align-center hero">
  <h1 class="h1 text-center weight-strong margin-top-sm">Weave + Docker for Mac: The bridge between local and remote services</h1>
</div>

<div class="grid-block grid-container col noscroll">
  <div class="grid-block align-center col post-details">
    
    <img class="avatar" src="images/authors/anandpatel.jpg" width="45" height="45">
    <div>by Anand Patel</div>
    <div>9 months ago in Engineering</div>
    <div class="grid-block social-sharing" data-url="http://runnable.com/blog/weave-docker-for-mac-the-bridge-between-local" data-legacy-url="http://blog.runnable.com/post/142665542481/weave-docker-for-mac-the-bridge-between-local">
      <a target="_blank" href="http://twitter.com/intent/tweet?url=http://runnable.com/blog/weave-docker-for-mac-the-bridge-between-local&via=GetRunnable" class="share-item share-twitter">
        <img src="images/logos/logo-twitter.svg" width="20" height="20">
        <span class="share-count small">0</span>
      </a>
      <a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=http://runnable.com/blog/weave-docker-for-mac-the-bridge-between-local" class="share-item share-linkedin">
        <img src="images/logos/logo-linkedin.svg" width="20" height="20">
        <span class="share-count small">0</span>
      </a>
      <a target="_blank" href="#" class="share-item share-hackernews hidden">
        <img src="images/logos/logo-hackernews.svg" width="20" height="20">
        <span class="share-count small">0</span>
      </a>
    </div>
  </div>
  <article class="article article-body">
    <p>Integration testing and debugging many microservices can be painful. Often, I need to debug a service on a staging environment. This article shows how we use Docker for Mac with Weave (an overlay network) to connect our local machine to our remote staging environments.</p>

<p>In my workflow, I usually create a WIP git commit, push it to staging, and try to debug with the Ubuntu server’s limited tools. I <em class="em">could</em> set up a bunch of SSH tunnels to connect to all the remote services, but our stack changes too frequently and finding IP addresses for each service is a pain. My dev machine is a Mac, so most of the tools we use locally don’t work on Linux.</p>

<p>I wanted something better that would speed up my dev and debugging flow. The first thing I tested with the Docker for Mac beta was Weave integration. Weave creates an overlay network to connect containers across multiple hosts together, which is very useful when distributing containers across a Swarm cluster.</p>

<p><img src="http://static.tumblr.com/mpxyjs6/7uEo5ibgb/weave-graphic.png" width="840" height="400" class="img post-graphic" alt="image" /></p>

<h3 class="h3">Requirements:</h3>

<ol class="ol"><li class="li">
    <p>Remote docker-engine. I used the latest engine (v1.10.3).</p>
  </li>
  <li class="li">
    <p><a class="link" href="https://github.com/weaveworks/weave#installation" target="_blank">Weave binary</a> on local and remote machine:</p>
    <p class="monospace"><code>sudo curl -L git.io/weave -o /usr/local/bin/weave</code></p>
    <p class="monospace"><code>sudo chmod a+x /usr/local/bin/weave</code></p>
  </li>
  <li class="li">
    <p><a class="link" href="https://beta.docker.com/" target="_blank">Docker for Mac</a> installed locally (similar steps can be followed if connecting from a Linux machine).</p>
  </li>
</ol>

<p class="em">Note: You don’t need to have Weave running beforehand; we can dynamically attach the Weave network to any existing container.</p>

<h3 class="h3">Step 1: Set up Weave network routers and proxy</h3>

<p>The first step is to set up our Weave overlay network so that we can connect to it from our local machine.</p>

<p class="strong">Remote machine:</p>
<ol class="ol"><li class="li">
    <p>Launch Weave router: <a id="footnote-1-source" href="#footnote-1" class="link">[1]</a></p>
    <p class="monospace"><code>weave launch-router --password &lt;password&gt;</code></p>
    <p>This will pull the latest Weave images and start the Weave router container. The password field is optional but recommended to prevent others from accessing your network while you are debugging.</p>
  </li>
  <li class="li">
    <p>Launch Weave proxy:</p>
    <p class="monospace"><code>weave launch-proxy</code></p>
    <p>This proxy will automatically attach your IP address. More info <a class="link" href="http://docs.weave.works/weave/latest_release/proxy.html" target="_blank">here</a>.</p>
  </li>
</ol>
<p class="strong">Local machine:</p>
<ol class="ol"><li class="li">
    <p>Test network connectivity of Weave ports:</p>
    <p class="monospace"><code>nc -z &lt;remote_host_ip_address&gt; 6783</code></p>
    <p>Ensure your firewalls and security groups allow Weave’s control port (TCP 6783) and data ports (UDP 6783/6784) on the remote machine to be accessible from your local machine. If you need to create an intermediate link, refer to <a id="footnote-2-source" class="link" href="#footnote-2">footnote #2</a>.</p>
  </li>
  <li class="li">
    <p>Launch Weave router on your local machine:</p>
    <p class="monospace"><code>weave launch-router --password &lt;password&gt; &lt;remote_host_ip_address&gt;</code></p>
    <p>If you set a password on the remote machine, ensure the same password is set here. <span class="monospace"><code>remote_host_ip_address</code></span> should be the IP address of the remote machine you set up above.</p>
  </li>
  <li class="li">
    <p>Verify Weave connection:</p>
    <p class="monospace"><code>weave status connections</code></p>
  </li>
  <li class="li">
    <p>Launch Weave proxy on the remote machine:</p>
    <p>If we were connecting from a Linux machine, we could use <span class="monospace"><code>weave launch-proxy</code></span>. However, we need to change this for Docker on Mac. The workaround is to tell Weave to listen on an HTTP interface:</p>
    <p class="monospace"><code>WEAVEPROXY_DOCKER_ARGS="-p 9999:9999" weave launch-proxy -H tcp://0.0.0.0:9999</code></p>
    <p><span class="monospace"><code>WEAVEPROXY_DOCKER_ARGS</code></span> tells Weave to publish to port 9999 so the host has access to it, and the <span class="monospace"><code>-H tcp://0.0.0.0:9999</code></span> tells Weave to listen on port 9999. If port 9999 is used on your machine, you can change it to any port, but ensure you replace 9999 with your port throughout the following steps.</p>
  </li>
</ol>

<h3 class="h3">Step 2: Launch containers into Weave network</h3>

<p>Now that we have the Weave routers and proxy set up, we need some containers to talk to. In this example I will use a MongoDB container.</p>

<p class="strong">Remote machine:</p>
<ol class="ol"><li class="li">
    <p>Configure Docker client to go through the Weave proxy.</p>
    <p class="monospace"><code>eval $(weave env)</code></p>
    <p>That command will set the <span class="monospace"><code>DOCKER_HOST</code></span> environment variable to point to the Weave proxy. <span class="em">Note: You’ll have use the same terminal session, or that variable will get unset</span>.</p>
  </li>
  <li class="li">
    <p>Run MongoDB container</p>
    <p class="monospace"><code>docker run -d --name=remote-mongo mongo</code></p>
    <p>The <span class="monospace"><code>--name</code></span> value is important here. It will be the hostname used to connect to this container. Notice that I did not expose any ports. Exposing ports to the host is not needed since all traffic to this container will be going through Weave. If you want to connect to an existing container, refer to <a id="footnote-3-source" class="link" href="#footnote-3">footnote #3</a>.</p>
  </li>
</ol>
<p class="strong">Local machine:</p>
<ol class="ol"><li class="li">
    <p>Configure our Docker client to go through the Weave proxy.</p>
    <p>We also need to setup the Mac Docker client to point to our proxy. This is a bit tricky since we did a custom proxy configuration.</p>
    <ol class="ol"><li class="li">
        <p>Obtain <span class="monospace"><code>docker.local</code></span> IP address:</p>
        <p class="monospace"><code>ping -c1 docker.local</code></p>
      </li>
      <li class="li">
        <p>Set <span class="monospace"><code>DOCKER_HOST</code></span> environment variable:</p>
        <p class="monospace"><code>export DOCKER_HOST=&lt;docker.local_ip_address&gt;:9999</code></p>
        <p><span class="monospace"><code>docker.local_ip_address</code></span> should be the IP address returned from the ping command. Same note from above — you have to say in the same terminal session or that variable will get unset.</p>
      </li>
    </ol></li>
  <li class="li">
    <p>Create a port forward container</p>
    <p class="monospace"><code>docker run -e REMOTE_HOST=remote-mongo -e REMOTE_PORT=27017 -p 27017:80 -d djfaze/port-forward</code></p>
    <p>In order to gain access to the remote machine, we need to set up a simple port forwarding container on our local machine. I used <a class="link" href="https://hub.docker.com/r/djfaze/port-forward/" target="_blank">this image</a>, which requires the following options to be passed to the <span class="monospace"><code>docker run</code></span> command:</p>
    <ol class="ul"><li class="li">
        <p class="monospace"><code>-e REMOTE_HOST=&lt;remote_container_name&gt;</code></p>
        <p>where <span class="monospace"><code>remote_container_name</code></span> is set to the hostname or Weave IP you want to forward to. Since we started the remote container with <span class="monospace"><code>--name=remote-mongo</code></span>, Weave DNS will resolve that name to the Weave IP address.</p>
      </li>
      <li class="li">
        <p class="monospace"><code>-e REMOTE_PORT=&lt;remote_container_port&gt;</code></p>
        <p>where <span class="monospace"><code>remote_container_port</code></span> is set to the port you want to connect to.</p>
      </li>
      <li class="li">
        <p class="monospace"><code>-p &lt;host_port&gt;:80</code></p>
        <p>where <span class="monospace"><code>host_port</code></span> is set to the port on your local machine you want to map to the remote container.</p>
      </li>
    </ol><p>The above example maps the local machine’s port 27017 to the remote container’s MongoDB port 27017.</p>
  </li>
</ol>

<h3 class="h3">Step 3: Connect and Play</h3>

<p>After everything is set up, <span class="monospace"><code>docker.local:27017</code></span> will point to the remote MongoDB container. I can now run my sample app server locally with all my local tools and simply configure my application to <span class="monospace"><code>docker.local:27017</code></span>. Integrating this with Runnable allows me to develop on my local machine with my entire isolated production stack without affecting anyone else, speeding up my feature development and bug bashing.</p>

<p>Using this technique, you can easily connect your local development machine to a staging environment and debug services just like you’d debug code locally.</p>

<p id="footnote-1" class="footnote">1: Weave’s default subnet is <span class="monospace"><code>10.32.0.0/12</code></span>. If your subnet overlaps, you will run into some issues. Add <span class="monospace"><code>--ipalloc-default-subnet &lt;subnet&gt;</code></span> and <span class="monospace"><code>--ipalloc-range &lt;subnet&gt;</code></span> to the Weave launch command where <span class="monospace"><code>subnet</code></span> is a CIDR for a non-overlapping network. <a class="link" href="#footnote-1-source">↩</a></p>

<p id="footnote-2" class="footnote">2: If your application is on a private network, you can create an intermediate link with a server on a public network that can talk to your private network. On the intermittent server, run <span class="monospace"><code>weave launch --password=&lt;your password&gt; &lt;ip_addr_of_private_host&gt;</code></span> and on your local, run <span class="monospace"><code>weave launch --password=&lt;your password&gt; &lt;ip_addr_of_intermediate_server&gt;</code></span>. <a class="link" href="#footnote-2-source">↩</a></p>

<p id="footnote-3" class="footnote">3: If you already have a container running and would like to attach to it, use <span class="monospace"><code>weave attach &lt;container_ID&gt;</code></span>. Note that DNS will not work. You will have to use the IP address returned from the <span class="monospace"><code>attach</code></span> command to connect. When using the port forwarder, use <span class="monospace"><code>-e REMOTE_HOST=&lt;weave_ip&gt;</code></span> where <span class="monospace"><code>weave ip</code></span> is the address returned from the <span class="monospace"><code>weave_attach</code></span> command. <a class="link" href="#footnote-3-source">↩</a></p>

  </article>

  <section class="grid-block col shrink justify-center align-center section-footer">
    <a class="grid-block shrink link text-center margin-bottom-lg margin-top-lg" href="/blog/">View All Posts</a>
    <div id="mc_embed_signup" class="grid-block justify-center">
  <form action="//runnable.us5.list-manage.com/subscribe/post?u=a67ad168d3259d6b0f4d103df&amp;id=504370029e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
    <div id="mc_embed_signup_scroll" class="grid-block col-xs mailchimp-form">
      <div class="mc-field-group">
        <input type="email" value="" name="EMAIL" class="input input-md" id="mce-EMAIL" placeholder="Your email">
      </div>
      <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
      </div>
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true">
        <input type="text" name="b_a67ad168d3259d6b0f4d103df_504370029e" tabindex="-1" value="">
      </div>
      <div class="clear grid-block justify-center">
        <input type="submit" value="Subscribe to New Posts" name="subscribe" id="mc-embedded-subscribe" class="btn btn-md gray">
      </div>
    </div>
  </form>
</div>
  </section>
</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="js/social-buttons.js"></script>

    </main>

    <footer class="grid-block col footer justify-spaced">
  <a href="https://runnable.com/signup" class="sign-up-box grid-block col well well-anchor track-sign-up">
  <img class="img no-touching" src="/blog/images/runnabear-hello.png">
  <p class="p">Try Runnable! It’s <strong class="weight-strong">free</strong> for 14 days.
  <div data-target="#sign-up" class="btn btn-sm green track-sign-up">Sign Up</div>
</a>

  <aside class="grid-block aside-support">
  <div class="grid-block col justify-center support-text">
    <p class="p weight-strong">Our engineers are here for you.</p>
    <p class="p">We can answer questions about Docker <br class="br">and help you set up your stack.</p>
  </div>
  <figure class="grid-block col figure shrink">
    <div class="grid-block shrink bubble">
      <img class="img float-left" src="/blog/images/logos/logo-slack.svg" height="18" width="18" alt="Slack">
      <div class="grid-block col">
        <div class="user">
          <strong class="strong user-name">Jorge</strong>
          <span class="user-time"> 4:19 PM</span>
        </div>
        <p class="p user-text">Can I run multiple commands?</p>
      </div>
    </div>
    <div class="grid-block shrink bubble">
      <img class="img float-left" src="/blog/images/runnabot-head.png" height="18" width="18" alt="Slack">
      <div class="grid-block col">
        <div class="user">
          <strong class="strong user-name">Taylor</strong>
          <span class="user-time"> 4:20 PM</span>
        </div>
        <p class="p user-text">Hi <span class="link-blue">@jorge</span>!
          <br>Yes you can. Here’s how: …
        </p>
      </div>
    </div>
  </figure>
</aside>

  <div class="grid-block link-wrapper">
    <div class="grid-block col align-start">
      <a href="/docs/" class="btn btn-xs link weight-strong">Docs</a>
      <a href="/for/" class="btn btn-xs link weight-strong">Product</a>
      <a href="/pricing/" class="btn btn-xs link weight-strong">Pricing</a>
      <a href="/how-it-works/" class="btn btn-xs link weight-strong">How It Works</a>
      <a href="https://runnable.com/docker/" class="btn btn-xs link weight-strong">Docker Guides</a>
      <a href="/demo/" class="btn btn-xs link weight-strong">Request Demo</a>
    </div>
    <div class="grid-block col align-start">
      <a href="https://runnable.com/use-cases/" class="btn btn-xs link weight-strong">Use Cases</a>
      <a href="/blog/" class="btn btn-xs link weight-strong">Blog</a>
      <a href="/about/" class="btn btn-xs link weight-strong">About</a>
      <a href="/legal/privacy-policy/" class="btn btn-xs link weight-strong">Privacy</a>
      <a href="/legal/terms-of-service/" class="btn btn-xs link weight-strong">Terms</a>
      <a href="/legal/acceptable-use-policy/" class="btn btn-xs link weight-strong">Acceptable Use</a>
    </div>
  </div>
</footer>


  </body>

</html>
