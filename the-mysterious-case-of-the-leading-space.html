<!doctype html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/blog/favicon.png">
  <link rel="stylesheet" href="//runnable.com/styles/index.css">
  <link rel="stylesheet" href="/blog/css/index.css">
  <meta property="og:image" content="//s3-us-west-1.amazonaws.com/runnable-design/fb-image.png">
  
    <meta name="twitter:title" content="The Mysterious Case of the Leading Space">
    <meta name="twitter:description" content="We had just performed an overhaul of how we handled logging across our services at Runnable. It appeared to work as intended — log files were being rotated and sent over to Loggly. I later learned we had a bug that was causing logs to be improperly formatted.“Logs aren’t formatting correctly for me.” My fellow engineer showed me what looked like JSON, which is what our various services produce as log output.“Looks OK to me,” I offered trepidatiously.“You would think so, but when I pipe it into Bunyan, nothing happens.”Sure enough, Bunyan wasn’t re-formatting the JSON as expected.">
    
  <meta name="twitter:image" content="https://s3-us-west-1.amazonaws.com/runnable-design/tw-image.png">
  <script src="//runnable.com/js/external/segment.js"></script>
  <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>The Mysterious Case of the Leading Space - Runnablog</title>
<meta property="og:title" content="The Mysterious Case of the Leading Space" />
<meta name="description" content="We had just performed an overhaul of how we handled logging across our services at Runnable. It appeared to work as intended — log files were being rotated and sent over to Loggly. I later learned we had a bug that was causing logs to be improperly formatted.“Logs aren’t formatting correctly for me.” My fellow engineer showed me what looked like JSON, which is what our various services produce as log output.“Looks OK to me,” I offered trepidatiously.“You would think so, but when I pipe it into Bunyan, nothing happens.”Sure enough, Bunyan wasn’t re-formatting the JSON as expected." />
<meta property="og:description" content="We had just performed an overhaul of how we handled logging across our services at Runnable. It appeared to work as intended — log files were being rotated and sent over to Loggly. I later learned we had a bug that was causing logs to be improperly formatted.“Logs aren’t formatting correctly for me.” My fellow engineer showed me what looked like JSON, which is what our various services produce as log output.“Looks OK to me,” I offered trepidatiously.“You would think so, but when I pipe it into Bunyan, nothing happens.”Sure enough, Bunyan wasn’t re-formatting the JSON as expected." />
<link rel="canonical" href="https://runnable.com/blog/the-mysterious-case-of-the-leading-space" />
<meta property="og:url" content="https://runnable.com/blog/the-mysterious-case-of-the-leading-space" />
<meta property="og:site_name" content="Runnablog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-05-03T00:00:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@GetRunnable" />
<meta name="twitter:creator" content="@" />
<meta property="article:publisher" content="Runnable" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "The Mysterious Case of the Leading Space",
"datePublished": "2016-05-03T00:00:00-07:00",
"description": "We had just performed an overhaul of how we handled logging across our services at Runnable. It appeared to work as intended — log files were being rotated and sent over to Loggly. I later learned we had a bug that was causing logs to be improperly formatted.“Logs aren’t formatting correctly for me.” My fellow engineer showed me what looked like JSON, which is what our various services produce as log output.“Looks OK to me,” I offered trepidatiously.“You would think so, but when I pipe it into Bunyan, nothing happens.”Sure enough, Bunyan wasn’t re-formatting the JSON as expected.",
"url": "https://runnable.com/blog/the-mysterious-case-of-the-leading-space"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://runnable.com/blog/feed.xml" title="Runnablog" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
  <script src="/blog/js/post-time.js"></script>
</head>


  <body class="page-landing">

    <svg xmlns="http://www.w3.org/2000/svg" class="icon-defintions">
  <symbol id="icons-bitbucket" viewBox="0 0 27.438 31.681">
    <path d='M29.208,3.519a3.47,3.47,0,0,0-.729-0.738,8.244,8.244,0,0,0-2.01-1.1A21.7,21.7,0,0,0,21.768.45,39.134,39.134,0,0,0,10.037.434,24.268,24.268,0,0,0,6,1.385,10.419,10.419,0,0,0,3.525,2.549a4.165,4.165,0,0,0-.976.869,1.832,1.832,0,0,0-.4,1.479C2.32,5.989,2.48,7.082,2.66,8.169q0.4,2.417.811,4.828c0.306,1.787.62,3.573,0.918,5.36a2.026,2.026,0,0,0,.526,1.07,5.663,5.663,0,0,0,.574.543,9.178,9.178,0,0,0,2.432,1.354,20.379,20.379,0,0,0,6.485,1.328,25.257,25.257,0,0,0,4.838-.187,19.46,19.46,0,0,0,4.011-.948,10.809,10.809,0,0,0,2.725-1.382,4.323,4.323,0,0,0,.945-0.9,1.791,1.791,0,0,0,.354-0.805c0.4-2.341.809-4.679,1.2-7.021,0.362-2.172.7-4.346,1.058-6.518A1.78,1.78,0,0,0,29.208,3.519ZM15.82,19.64a4.361,4.361,0,1,1,4.386-4.334A4.359,4.359,0,0,1,15.82,19.64Zm8.7-15.246a1.832,1.832,0,0,1-.436.357,5.524,5.524,0,0,1-1.454.541,20.191,20.191,0,0,1-2.9.485,37.5,37.5,0,0,1-3.791.188,37.891,37.891,0,0,1-4.332-.238,15.852,15.852,0,0,1-3.146-.633,6.893,6.893,0,0,1-.883-0.381,1.385,1.385,0,0,1-.386-0.3A0.443,0.443,0,0,1,7.2,3.746,1.752,1.752,0,0,1,7.61,3.43a5.392,5.392,0,0,1,1.359-.512,20.355,20.355,0,0,1,2.994-.509,37.618,37.618,0,0,1,4.967-.172,30.478,30.478,0,0,1,4.55.431,10.33,10.33,0,0,1,2.075.545,5.336,5.336,0,0,1,.683.346,1.085,1.085,0,0,1,.288.266A0.422,0.422,0,0,1,24.522,4.394Zm1.664,18.367a0.955,0.955,0,0,1-.021.271c-0.305,1.6-.614,3.2-0.911,4.811a2.6,2.6,0,0,1-.724,1.377,5.442,5.442,0,0,1-1.448,1.023A12.151,12.151,0,0,1,20,31.274a18.806,18.806,0,0,1-3.563.407,20.746,20.746,0,0,1-5.917-.7,9.9,9.9,0,0,1-2.3-.953,5.078,5.078,0,0,1-1.042-.789,2.6,2.6,0,0,1-.741-1.4c-0.3-1.6-.609-3.207-0.915-4.81A1.12,1.12,0,0,1,5.5,22.79a0.479,0.479,0,0,1,.724-0.423c0.036,0.021.072,0.041,0.105,0.063a13.221,13.221,0,0,0,3.858,1.856,18.062,18.062,0,0,0,3.873.758,19.587,19.587,0,0,0,4.54-.11,16.41,16.41,0,0,0,5.687-1.827c0.354-.194.686-0.43,1.025-0.646a1.715,1.715,0,0,1,.167-0.1A0.48,0.48,0,0,1,26.186,22.761Zm-8.159-7.477a2.185,2.185,0,1,1-2.177-2.193A2.192,2.192,0,0,1,18.027,15.284Z', transform='translate(-2.122)'</<path d="M29.208,3.519a3.47,3.47,0,0,0-.729-0.738,8.244,8.244,0,0,0-2.01-1.1A21.7,21.7,0,0,0,21.768.45,39.134,39.134,0,0,0,10.037.434,24.268,24.268,0,0,0,6,1.385,10.419,10.419,0,0,0,3.525,2.549a4.165,4.165,0,0,0-.976.869,1.832,1.832,0,0,0-.4,1.479C2.32,5.989,2.48,7.082,2.66,8.169q0.4,2.417.811,4.828c0.306,1.787.62,3.573,0.918,5.36a2.026,2.026,0,0,0,.526,1.07,5.663,5.663,0,0,0,.574.543,9.178,9.178,0,0,0,2.432,1.354,20.379,20.379,0,0,0,6.485,1.328,25.257,25.257,0,0,0,4.838-.187,19.46,19.46,0,0,0,4.011-.948,10.809,10.809,0,0,0,2.725-1.382,4.323,4.323,0,0,0,.945-0.9,1.791,1.791,0,0,0,.354-0.805c0.4-2.341.809-4.679,1.2-7.021,0.362-2.172.7-4.346,1.058-6.518A1.78,1.78,0,0,0,29.208,3.519ZM15.82,19.64a4.361,4.361,0,1,1,4.386-4.334A4.359,4.359,0,0,1,15.82,19.64Zm8.7-15.246a1.832,1.832,0,0,1-.436.357,5.524,5.524,0,0,1-1.454.541,20.191,20.191,0,0,1-2.9.485,37.5,37.5,0,0,1-3.791.188,37.891,37.891,0,0,1-4.332-.238,15.852,15.852,0,0,1-3.146-.633,6.893,6.893,0,0,1-.883-0.381,1.385,1.385,0,0,1-.386-0.3A0.443,0.443,0,0,1,7.2,3.746,1.752,1.752,0,0,1,7.61,3.43a5.392,5.392,0,0,1,1.359-.512,20.355,20.355,0,0,1,2.994-.509,37.618,37.618,0,0,1,4.967-.172,30.478,30.478,0,0,1,4.55.431,10.33,10.33,0,0,1,2.075.545,5.336,5.336,0,0,1,.683.346,1.085,1.085,0,0,1,.288.266A0.422,0.422,0,0,1,24.522,4.394Zm1.664,18.367a0.955,0.955,0,0,1-.021.271c-0.305,1.6-.614,3.2-0.911,4.811a2.6,2.6,0,0,1-.724,1.377,5.442,5.442,0,0,1-1.448,1.023A12.151,12.151,0,0,1,20,31.274a18.806,18.806,0,0,1-3.563.407,20.746,20.746,0,0,1-5.917-.7,9.9,9.9,0,0,1-2.3-.953,5.078,5.078,0,0,1-1.042-.789,2.6,2.6,0,0,1-.741-1.4c-0.3-1.6-.609-3.207-0.915-4.81A1.12,1.12,0,0,1,5.5,22.79a0.479,0.479,0,0,1,.724-0.423c0.036,0.021.072,0.041,0.105,0.063a13.221,13.221,0,0,0,3.858,1.856,18.062,18.062,0,0,0,3.873.758,19.587,19.587,0,0,0,4.54-.11,16.41,16.41,0,0,0,5.687-1.827c0.354-.194.686-0.43,1.025-0.646a1.715,1.715,0,0,1,.167-0.1A0.48,0.48,0,0,1,26.186,22.761Zm-8.159-7.477a2.185,2.185,0,1,1-2.177-2.193A2.192,2.192,0,0,1,18.027,15.284Z" transform="translate(-2.122)"/>
  </symbol>
  <symbol id="icons-check" viewBox='0 0 14.5 10'>
    <path d="M7.25,14a1,1,0,0,1-.707-0.293l-4.5-4.5A1,1,0,0,1,3.457,7.793L7.25,11.586l7.293-7.293a1,1,0,0,1,1.414,1.414l-8,8A1,1,0,0,1,7.25,14Z" transform="translate(-1.75 -4)"/>
  </symbol>
  <symbol id="icons-chevron-right" viewBox='0 0 11 18'>
    <polyline points="1 1 10 9 1 17" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
  </symbol>
  <symbol id="icons-chevron-down" viewBox='0 0 18 11'>
    <polyline points="17 1 9 10 1 1" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline>
  </symbol>
  <symbol id="icons-close" viewBox="0 0 30 30">
    <path d="M21,22.2c-0.3,0-0.5-0.1-0.7-0.3L15,16.6l-5.3,5.3c-0.4,0.4-1,0.4-1.4,0s-0.4-1,0-1.4l5.3-5.3L8.3,9.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-5.3,5.3l5.3,5.3c0.4,0.4,0.4,1,0,1.4C21.5,22.1,21.3,22.2,21,22.2z"/>
  </symbol>
  <symbol id="icons-external" viewBox="0 0 15 15">
    <path fill="currentColor" d="M9.5,9a0.5,0.5,0,0,1-.354-0.854L14.293,3H11a0.5,0.5,0,0,1,0-1h4.506a0.5,0.5,0,0,1,.32.121h0a0.56,0.56,0,0,1,.07.074,0.5,0.5,0,0,1,.1.269c0,0.013,0,.026,0,0.039V7a0.5,0.5,0,0,1-1,0V3.707L9.854,8.854A0.5,0.5,0,0,1,9.5,9Z" transform="translate(-1 -2)"/><path d="M13.317,8.218L13,8.535V14a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V7A2,2,0,0,1,4,5H9.465l0.317-.317A2.5,2.5,0,0,1,9.027,4H4A3,3,0,0,0,1,7v7a3,3,0,0,0,3,3h7a3,3,0,0,0,3-3V8.973A2.5,2.5,0,0,1,13.317,8.218Z" transform="translate(-1 -2)"/>
  </symbol>
  <symbol id="icons-github" viewBox="0 0 24 23.41">
    <path d="M24.336,7.791A12.011,12.011,0,0,1,25.52,23.366a12.083,12.083,0,0,1-5.883,4.313A0.686,0.686,0,0,1,19,27.549a0.648,0.648,0,0,1-.187-0.457l0.023-3.281a3.861,3.861,0,0,0-.258-1.395,2.219,2.219,0,0,0-.562-0.832,7.008,7.008,0,0,0,3.738-1.348Q23.41,19.03,23.5,15.655a5.127,5.127,0,0,0-.34-1.782,4.569,4.569,0,0,0-.9-1.43,3.254,3.254,0,0,0,.234-1.078,4.936,4.936,0,0,0-.352-2.109,1.719,1.719,0,0,0-.8.035A7.4,7.4,0,0,0,18.84,10.5a11.493,11.493,0,0,0-6,0,7.4,7.4,0,0,0-2.508-1.207,1.719,1.719,0,0,0-.8-0.035,4.936,4.936,0,0,0-.352,2.109,3.254,3.254,0,0,0,.234,1.078,4.569,4.569,0,0,0-.9,1.43,5.127,5.127,0,0,0-.34,1.782Q8.27,19.03,9.91,20.237a6.976,6.976,0,0,0,3.75,1.348,1.934,1.934,0,0,0-.48.633,3.414,3.414,0,0,0-.293.984,3.316,3.316,0,0,1-1.594.293,2.42,2.42,0,0,1-1.9-1.3,3.234,3.234,0,0,0-.645-0.75,1.767,1.767,0,0,0-1.184-.469q-0.7.023-.527,0.3a1.324,1.324,0,0,0,.551.469,2.583,2.583,0,0,1,.75.82,5.653,5.653,0,0,1,.469.867,2.2,2.2,0,0,0,.984,1.172,4.5,4.5,0,0,0,3.047.258l0.023,2.227a0.648,0.648,0,0,1-.187.457,0.686,0.686,0,0,1-.633.129A12.083,12.083,0,0,1,6.16,23.366,12,12,0,0,1,24.336,7.791Z" transform="translate(-3.84 -4.287)"/>
  </symbol>
  <symbol id="icons-life-preserver" viewBox='0 0 18 18'>
    <path d="M9,17A8,8,0,1,0,1,9,8,8,0,0,0,9,17ZM9,5A4,4,0,1,1,5,9,4,4,0,0,1,9,5Z" transform="translate(-1 -1)" fill="#fff"/><path d="M9,2A7,7,0,1,1,2,9,7.008,7.008,0,0,1,9,2M9,13.5A4.5,4.5,0,1,0,4.5,9,4.505,4.505,0,0,0,9,13.5M9,1a8,8,0,1,0,8,8A8,8,0,0,0,9,1H9ZM9,12.5A3.5,3.5,0,1,1,12.5,9,3.5,3.5,0,0,1,9,12.5H9Z" transform="translate(-1 -1)"/><path d="M5.259,7.623A3.989,3.989,0,0,1,7.623,5.259L4.654,2.289A8.032,8.032,0,0,0,2.29,4.653Z" transform="translate(-1 -1)"/><path d="M12.741,10.377a3.989,3.989,0,0,1-2.364,2.364l2.969,2.969a8.032,8.032,0,0,0,2.364-2.364Z" transform="translate(-1 -1)"/><path d="M7.623,12.741a3.989,3.989,0,0,1-2.364-2.364L2.289,13.346A8.032,8.032,0,0,0,4.653,15.71Z" transform="translate(-1 -1)"/><path d="M10.377,5.259a3.989,3.989,0,0,1,2.364,2.364l2.969-2.969A8.032,8.032,0,0,0,13.347,2.29Z" transform="translate(-1 -1)"/>
  </symbol>
  <symbol id="icons-overflow" viewBox="0 0 18 4.688">
    <path fill="currentColor" d="M2.344,7.656A1.344,1.344,0,1,1,1,9,1.345,1.345,0,0,1,2.344,7.656m0-1A2.344,2.344,0,1,0,4.688,9,2.344,2.344,0,0,0,2.344,6.656h0Z" transform="translate(0 -6.656)"/><path fill="currentColor" d="M9,7.656A1.344,1.344,0,1,1,7.656,9,1.345,1.345,0,0,1,9,7.656m0-1A2.344,2.344,0,1,0,11.344,9,2.344,2.344,0,0,0,9,6.656H9Z" transform="translate(0 -6.656)"/><path fill="currentColor" d="M15.656,7.656A1.344,1.344,0,1,1,14.313,9a1.345,1.345,0,0,1,1.344-1.344m0-1A2.344,2.344,0,1,0,18,9a2.344,2.344,0,0,0-2.344-2.344h0Z" transform="translate(0 -6.656)"/>
  </symbol>
</svg>

    <header class="grid-block shrink header">
  <div class="grid-block grid-container justify-justified">
    <a href="/" class="grid-block align-center shrink logo">
      <img class="img" src="https://runnable.com/images/runnable-logo.svg" height="36" width="192">
    </a>
    <nav class="nav grid-block shrink">
      <div class="grid-content btn btn-sm text-white weight-strong hidden-xs a popover-trigger hover has-links" tabindex="1">
        <div class="div">Features
          <svg class="icons icons-chevron-down">
            <use xlink:href="#icons-chevron-down">
          </svg>
        </div>
        <div class="popover-hover-wrapper popover-feature">
  <div class="grid-block col list text-left popover popover-header-menu bottom">
    <a href="/preview-environments/" class="grid-block align-center a padding-sm">
      <img src="/blog/images/icons-staging.svg" height="45" width="45" class="img">
      <div class="grid-block col">
        <p class="p weight-strong">Preview Environments</p>
        <p class="small">Isolated, full-stack environments for every branch.</p>
      </div>
    </a>
    <a href="/end-to-end-testing/" class="grid-block align-center a padding-sm">
      <img src="/blog/images/icons-testing.svg" height="45" width="45" class="img">
      <div class="grid-block col">
        <p class="p weight-strong">End-to-end Testing</p>
        <p class="small">Test every code change on its own preview environment.</p>
      </div>
    </a>
    <a href="/deploy-to-production/" class="grid-block align-center a padding-sm">
      <img src="/blog/images/icons-deploy.svg" height="45" width="45" class="img">
      <div class="grid-block col">
        <p class="p weight-strong">Deploy to Production</p>
        <p class="small">Deploy fully-tested builds to any environment.</p>
      </div>
    </a>
  </div>
</div>

      </div>
      <a href="/docs/" class="grid-content btn btn-sm text-white weight-strong hidden-sm a">Docs</a>
      <a href="/pricing/" class="grid-content btn btn-sm text-white weight-strong hidden-md">Pricing</a>
      <a href="/signup/" class="grid-content btn btn-sm btn-white text-white weight-strong hidden-xs track-sign-up">Sign Up</a>
      <div class="grid-content btn btn-sm btn-overflow popover-trigger hover has-links" tabindex="1">
        <svg class="icons icons-overflow">
          <use xlink:href="#icons-overflow">
        </svg>
        <div class="popover-hover-wrapper right-align-sm">
  <div class="grid-block popover popover-header-menu bottom">
    <div class="grid-block col list text-left">
      <small class="small visible-xs text-gray-light margin-left-sm">Features</small>
      <a href="/preview-environments/" class="grid-block align-center list-item-a list-item-feature visible-xs">
        <img src="/blog/images/icons-staging.svg" height="30" width="30" class="img">
        Preview Environments
      </a>
      <a href="/end-to-end-testing/" class="grid-block align-center list-item-a list-item-feature visible-xs">
        <img src="/blog/images/icons-testing.svg" height="30" width="30" class="img">
        End-to-end Testing
      </a>
      <a href="/deploy-to-production/" class="grid-block align-center list-item-a list-item-feature visible-xs">
        <img src="/blog/images/icons-deploy.svg" height="30" width="30" class="img">
        Deploy to Production
      </a>
      <div class="list-item divider visible-xs"></div>
      <a href="/signup/" class="list-item-a visible-xs track-sign-up">Sign Up</a>
      <div class="list-item divider visible-md"></div>
      <a href="/docs/" class="list-item-a visible-sm">Docs</a>
      <a href="/pricing/" class="list-item-a visible-md">Pricing</a>
      <a href="/how-it-works/" class="list-item-a">How It Works</a>
      <a href="/use-cases/" class="list-item-a">Use Cases</a>
      <a href="/blog/" class="list-item-a">Blog</a>
      <a href="/contact/" class="list-item-a">Contact</a>
      <a href="/about/" class="list-item-a">About</a>
    </div>
  </div>
</div>

      </div>
    </div>
  </nav>
</header>


    <main class="grid-block col main">
      <div class="grid-block col align-center hero hero-post"></div>

<div class="grid-block grid-container col noscroll">
  <div class="grid-block align-center col post-details">
    <h1 class="h1 text-center weight-strong margin-top-sm post-title">The Mysterious Case of the Leading Space</h1>
    
    <img class="avatar" src="images/authors/chrisneill.jpg" width="45" height="45">
    <div>by <a class="link" href="/blog/chris_neill">Chris Neill</a></div>
    <div><time class="time-capitalize" datatime="2016-05-03 00:00:00 -0700">2016-05-03 00:00:00 -0700</time> in Engineering</div>
    <div class="grid-block social-sharing" data-url="https://runnable.com/blog/the-mysterious-case-of-the-leading-space" data-legacy-url="http://blog.runnable.com/post/143767821746/the-mysterious-case-of-the-leading-space">
      <a target="_blank" href="https://twitter.com/intent/tweet?text=The Mysterious Case of the Leading Space&url=https://runnable.com/blog/the-mysterious-case-of-the-leading-space&via=GetRunnable" class="share-item share-twitter">
        <img src="images/logos/logo-twitter.svg" width="20" height="20">
        <span class="share-count small">0</span>
      </a>
      <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://runnable.com/blog/the-mysterious-case-of-the-leading-space" class="share-item share-linkedin">
        <img src="images/logos/logo-linkedin.svg" width="20" height="20">
        <span class="share-count small">0</span>
      </a>
      <a target="_blank" href="#" class="share-item share-hackernews hidden">
        <img src="images/logos/logo-hackernews.svg" width="20" height="20">
        <span class="share-count small">0</span>
      </a>
    </div>
  </div>
  <article class="article article-body">
    <p class="p">We had just performed an overhaul of how we handled logging across our services at Runnable. It appeared to work as intended — log files were being rotated and sent over to Loggly. I later learned we had a bug that was causing logs to be improperly formatted.</p>

<p class="p">“Logs aren’t formatting correctly for me.” My fellow engineer showed me what looked like JSON, which is what our various services produce as log output.</p>

<p class="p">“Looks OK to me,” I offered trepidatiously.</p>

<p class="p">“You would think so, but when I pipe it into Bunyan, nothing happens.”</p>

<p class="p">Sure enough, <a href="https://github.com/trentm/node-bunyan" class="link">Bunyan</a> wasn’t re-formatting the JSON as expected.</p>

<p class="p">Log formatting wasn’t an issue until I decided I’d stick my neck out and “fix it.” Before I joined Runnable, various services were started inside Docker containers that dumped standard output directly into log files. Outside those containers, on the host system, the rsyslog service would "follow" a given output file, pushing each new log message to our remote logging service (<a href="https://www.loggly.com/" class="link">Loggly</a>) as they happened.</p>

<p class="p">I quickly realized that this was going to cause trouble at scale. For one thing, logs were filling up our system volumes and we had no real way to rotate logs. So I had taken it upon myself to “fix” it.</p>

<p class="p">Undertaking this task involved making changes across all of our services: engineering would need to refactor what was being logged, and operations would have to handle how logs would end up being shipped to Loggly.</p>

<p class="p">So I rolled up my sleeves, dusted off my JavaScript books, checked out all of the repositories, and started to go through every blessed “lib/logger.js” one by one.</p>

<p class="p">Then another engineer at Runnable said to me, “Check this out, we can just use docker-engine’s syslog driver to send the output of whatever is running in the container to rsyslog.”</p>

<p class="p">Now I was left to tangle with rsyslog. “This will be a cinch,” I thought to myself.</p>

<p class="p">Nope.</p>

<p class="p">The devil, they say, is in the details.</p>

<p class="p">I saw no issue with the default output format for rsyslog to write logs into <code class="monospace">/var/log</code> on hosts. Doing so would produce output like this:</p>

<pre class="pre"><code class="monospace">Apr 29 21:55:11 ip-10-12-14-64 testapp: {"name":"deacon-blues", "pid":69, "hostname":"crimson.tide", "_id": "31337d43db33f", "level":30, "epoch":"this is the age of the exanding man", "theseWomen":"languid and bittersweet", "drink":"scotch whisky all night long", "die":"behind the wheels", "msg":"They call Alabama the Crimson Tide.", "time":"1977-09-23T15:15:15.015Z", "v":0}</code></pre>

<p class="p">And that’s good enough for me because:</p>

<pre class="pre"><code class="monospace"><span class="text-purple-light">/var/log$</span> grep deacon /var/log/syslog|sed 's/^.*name\"\:/{"name":/g'|jq "."
{
  "v": 0,
  "time": "1977-09-23T15:15:15.015Z",
  "name": "crimson.tide",
  "_id": "31337d43db33f",
  "level": 30,
  "epoch": "this is the age of the expanding man",
  "theseWomen": "languid and bittersweet",
  "drink": "scotch whisky all night long",
  "die": "behind the wheels",
  "msg": "They call Alabama the Crimson Tide."
}</code></pre>

<p class="p">But what’s good enough for me is not expedient for our engineers who are expecting something more like:</p>

<pre class="pre"><code class="monospace"><span class="text-purple-light">/var/log$</span> bunyan ~ubuntu/gibberish.json
[1977-09-23T15:15:15.015Z]  INFO: deacon-blues/69 on crimson.tide: They call Alabama the Crimson Tide. (_id=31337d43db33f, epoch="this is the age of the expanding man", theseWomen="languid and bittersweet", drink="scotch whisky all night long", die="behind the wheels")
[2016-03-31T08:32:12.511Z]  INFO: api/30 on api: a message (environment=pre-productionn, module=lib/middlewares/domains.js)
    branch: 5and3r52016

    --
    commit: SAN-31337-do-a-thing</code></pre>

<p class="p">We had arrived at the following format string as a rsyslog output template:</p>

<pre class="pre"><code class="monospace">$template Strip_Headers,"%msg%\n"</code></pre>

<p class="p">Which would produce output like this:</p>

<pre class="pre"><code class="monospace"><span class="text-purple-light">bash-3.2$</span> cat /tmp/scrubbable.json |bunyan
 {"name":"api","branch":"5and3r52016\n","commit":"SAN-31337-wub-a-lub-a-dub-dub\n","environment":"pre-prod","hostname":"api","pid":30,"module":"lib/models/apis/github.js","level":10,"tx":{"tid":"68a3798a-0e59-11e6-9f53-0a2ee7c3b2b9","url":"GET /instances/d29c258a-0e59-11e6-b223-0a2ee7c3b2b9/dependencies","reqStart":"2016-04-29T22:21:25.932Z","txMSDelta":349},"msg":"Github.prototype._runQueryAgainstCache checkDataAndRunAnyRequest - extending the caches expiration","time":"2016-04-29T22:21:26.349Z","src":{"file":"/api/lib/models/apis/github.js","line":446,"func":"cache304Response"},"v":0}
 {"name":"api","branch":"5and3r52016\n","commit":"SAN-31337-wub-a-lub-a-dub-dub\n","environment":"pre-prod","hostname":"api","pid":30,"module":"lib/routes/github/index.js","level":10,"tx":{"txTimestamp":"2016-04-29T22:21:26.425Z"},"statusCode":200,"msg":"cache miss","time":"2016-04-29T22:21:26.425Z","src":{"file":"/api/lib/routes/github/index.js","line":211,"func":"handleGithubCacheMissRes"},"v":0}</code></pre>

<p class="p">Looks like JSON to me, but not to Bunyan — which brings us back to the improper log formatting issue mentioned earlier.</p>

<p class="p">I stared at it. Another engineer stared at it. We stared at it together.</p>

<p class="p">The gears turned ever so slowly.</p>

<p class="p">“Is that a leading space in front on the curly bracket?”</p>

<p class="p">“Son of a…”</p>

<pre class="pre"><code class="monospace"><span class="text-purple-light">bash-3.2$</span> cat /tmp/scrubbable.json | sed 's/^ //g' | bunyan
[2016-04-29T22:21:26.349Z] TRACE: api/30 on api (/api/lib/models/apis/github.js:446 in cache304Response): Github.prototype._runQueryAgainstCache checkDataAndRunAnyRequest - extending the caches expiration (environment=pre-prod, module=lib/models/apis/github.js)
    branch: 5and3r52016

    --
    commit: SAN-31337-wub-a-lub-a-dub-dub

    --
    tx: {
      "tid": "68a3798a-0e59-11e6-9f53-0a2ee7c3b2b9",
      "url": "GET /instances/d29c258a-0e59-11e6-b223-0a2ee7c3b2b9/dependencies",
      "reqStart": "2016-04-29T22:21:25.932Z",
      "txMSDelta": 349
    }
[2016-04-29T22:21:26.425Z] TRACE: api/30 on api (/api/lib/routes/github/index.js:211 in handleGithubCacheMissRes): cache miss (environment=pre-prod, module=lib/routes/github/index.js, statusCode=200)
    branch: 5and3r52016

    --
    commit: SAN-31337-wub-a-lub-a-dub-dub

    --
    tx: {
      "txTimestamp": "2016-04-29T22:21:26.425Z"
    }</code></pre>

<h3 class="h3">You’ve Come A Long Way, %msg%</h3>

<p class="p">I’d succeeded in convincing everyone at Runnable that we needed to change how we were doing logging, went through several revisions of configurations to get away from simply dumping STDOUT into a file, and even written a couple of log modules for services we were upstarting.</p>

<p class="p">I felt like I had moved mountains. Logs were now rotating on the hour, we had a sane archiving mechanism in place, and we’d clean up log files we didn’t need any more. No longer would we lose track of file handles, or worse, have log files that grew to be many GB in size.</p>

<p class="p">Now all I had to do was get rid of a single leading space.</p>

<p class="p">I started to zero in on something called “the Property Replacer” and to my great chagrin realized that the solution had been one Google search away from me: “rsyslog leading space”. About three links down was <a href="http://kb.monitorware.com/how-remove-messages-prefix-t12116.html" class="link">this post</a> from a support forum.</p>

<p class="p">Now I had my answer. <code class="monospace">%msg%\n</code> becomes <code class="monospace">%msg:2:$:%\n</code>.</p>

<p class="p">What this statement does, effectively, is start printing the syslog <code class="monospace">MSG</code> field from the second character of the field to the end of the field.</p>

<p class="p">One configuration line, five added characters.</p>

<p class="p">Welcome to my world. The leading space was gone and Bunyan (and everyone else) was happy.</p>

  </article>

  <section class="grid-block shrink justify-center align-center section-footer">
    <a class="grid-block shrink link text-center padding-sm" href="/blog/">View All Posts</a>
  </section>
</div>

<script src="js/social-buttons.js"></script>

    </main>

    <footer class="grid-block col footer justify-spaced">
  <aside class="grid-block aside-support">
  <div class="grid-block col justify-center support-text">
    <p class="p weight-strong">Our engineers are here for you.</p>
    <p class="p">We can answer questions about Docker <br class="br">and help you set up your stack.</p>
  </div>
  <figure class="grid-block col figure shrink">
    <div class="grid-block shrink bubble">
      <img class="img float-left" src="/blog/images/logos/logo-slack.svg" height="18" width="18" alt="Slack">
      <div class="grid-block col">
        <div class="user">
          <strong class="strong user-name">Jorge</strong>
          <span class="user-time"> 4:19 PM</span>
        </div>
        <p class="p user-text">Can I run multiple commands?</p>
      </div>
    </div>
    <div class="grid-block shrink bubble">
      <img class="img float-left" src="/blog/images/runnabot-head.png" height="18" width="18" alt="Slack">
      <div class="grid-block col">
        <div class="user">
          <strong class="strong user-name">Taylor</strong>
          <span class="user-time"> 4:20 PM</span>
        </div>
        <p class="p user-text">Hi <span class="link-blue">@jorge</span>!
          <br>Yes you can. Here’s how: …
        </p>
      </div>
    </div>
  </figure>
</aside>

  <div class="grid-block link-wrapper">
    <div class="grid-block col align-start">
      <h4 class="h4">Product</h4>
      <a href="/preview-environments/" class="a">Preview Environments</a>
      <a href="/end-to-end-testing/" class="a">End-to-End Testing</a>
      <a href="/deploy-to-production/" class="a">Deploy to Production</a>
      <a href="/use-cases/" class="a">Use Cases</a>
      <a href="/how-it-works/" class="a">How It Works</a>
      <a href="/pricing/" class="a">Pricing</a>
      <h4 class="h4 margin-top-sm">Help</h4>
      <a href="/docs/" class="a">Docs</a>
      <a href="/docker/" class="a">Docker Guides</a>
    </div>
    <div class="grid-block col align-start">
      <h4 class="h4">Company</h4>
      <a href="/about/" class="a">About</a>
      <a href="/blog/" class="a">Blog</a>
      <a href="/contact/" class="a">Contact</a>
      <a href="https://www.facebook.com/runnable/" class="a">Facebook</a>
      <a href="https://twitter.com/GetRunnable" class="a">Twitter</a>
      <a href="https://www.linkedin.com/company/runnable" class="a">Linkedin</a>
      <h4 class="h4 margin-top-sm">Legal</h4>
      <a href="/legal/privacy-policy/" class="a">Privacy</a>
      <a href="/legal/terms-of-service/" class="a">Terms</a>
      <a href="/legal/acceptable-use-policy/" class="a">Acceptable Use</a>
    </div>
  </div>
</footer>

  </body>

</html>
